function string2XML(a){return new window.DOMParser().parseFromString(a,"text/xml")}async function fetchEnaXml(a){const b=await fetch(`https://www.ebi.ac.uk/ena/browser/api/xml/${a}`).then(a=>a.text());return string2XML(b)}function clearEnaInfo(){const a=document.querySelector("#ena-info");a.querySelectorAll("p").forEach(a=>{a.remove()})}function appendEnaInfo(a,b){const c=document.querySelector("#ena-info"),d=document.createElement("p");d.innerHTML=`<strong>${a}:</strong>${b}`,c.appendChild(d)}function updateType(a,b){a.querySelector(".cell.type>.attr.field.type_").value=b,changedAttributeType(a)}function cleanNameField(a){return clean=a.replace(/[ /-]/g,"_").replace(/[()]/g,"")}function field2Attribute(a){const b=Object.create(ATTRIBUTE);b.ena_name=a.querySelector("NAME").innerHTML;const c=a.querySelector("LABEL").innerHTML;b.general_name=cleanNameField(b.ena_name),b.label=c.slice(0,1).toUpperCase()+c.slice(1).toLowerCase(),b.description=a.querySelector("DESCRIPTION").innerHTML,b.ena_requirement=a.querySelector("MANDATORY").innerHTML;const d=a.querySelector("FIELD_TYPE").children[0];switch(d.tagName){case"TEXT_FIELD":const a=d.querySelector("REGEX_VALUE");null!==a&&(b.pattern=a.innerHTML);break;case"TEXT_AREA_FIELD":break;case"TEXT_CHOICE_FIELD":b.type_="select",b.options=Array.from(d.querySelectorAll("TEXT_VALUE")).map(a=>a.querySelector("VALUE").innerHTML);}const e=a.querySelector("UNITS");return e&&(b.ena_units=Array.from(e.querySelectorAll("UNIT")).map(a=>a.innerHTML)),b}function parseFieldGroup(a){let b,c;Array.from(a.querySelectorAll("FIELD")).forEach(a=>{c=TEMPLATE_EDITOR.appendBlankRow(),b=field2Attribute(a),c.setFromAttribute(b)})}async function parseXmlChecklist(){const a=document.querySelector("#ena-import > #ena-checklist").value,b=await fetchEnaXml(a),c=b.querySelector(`CHECKLIST_SET > CHECKLIST[checklistType='Sample'][accession='${a}']`);if(null===c)return void alert("Mismatch in accession number!");if(c.querySelector("IDENTIFIERS>PRIMARY_ID").innerHTML!=a)return void alert("Mismatch in accession number!");const d=c.querySelector("DESCRIPTOR");clearEnaInfo(),appendEnaInfo("Label",d.querySelector("LABEL").innerHTML),appendEnaInfo("Name",d.querySelector("NAME").innerHTML),appendEnaInfo("Description",d.querySelector("DESCRIPTION").innerHTML),appendEnaInfo("Authority",d.querySelector("AUTHORITY").innerHTML),Array.from(c.querySelectorAll("FIELD_GROUP")).forEach(a=>{parseFieldGroup(a)})}function fetchEnaData(){parseXmlChecklist()}