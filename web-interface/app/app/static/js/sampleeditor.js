const SAMPLE_EDITOR=document.querySelector("#sample-editor").tBodies[0],TEMPLATE_NAME=document.querySelector("#template-name").value,SAMPLE_NAME_ATTR={general_name:"name",label:"Sample name",description:"Unique name to differentiate between registered samples.",pattern:"\\w+",type_:"sample_name",value:""},SHORT_DESCRIPTION_ATTR={general_name:"short_description",label:"Short description",description:"A short description to more easily identify the sample.",type_:"text",value:""};function createAttributeField(e,t=""){let l;switch(e.type_){case"text":(l=new TextField(t)).setPattern(e.pattern);break;case"select":l=new SelectField(t,e.options);break;case"date":l=new DateField(t);break;case"template":(l=new TextField(t)).input.placeholder=e.template,l.input.setAttribute("template-string",e.template),l.addClasses(["template"]);break;case"file":l=new FileField(t);break;case"sample_name":(l=new TextField(t)).pattern=e.pattern}return e.value?l.setValue(e.value):l.setValue(e.default),l.addClasses(["attrfield",e.general_name]),"template"!=e.type_&&l.input.addEventListener("change",function(){updateTemplateFields()},!1),l}function updateTemplateFields(e){Array.from(SAMPLE_EDITOR.querySelectorAll("td.sample.template")).forEach(e=>{let l=e.getAttribute("sample"),t=e.querySelector(".attrfield"),a=parseTemplateString(t.getAttribute("template-string"));a.filter(e=>"const"!=e.type).forEach(e=>{let t=e.value;"sample_name"==e.value&&(t="name"),e.fieldValue=SAMPLE_EDITOR.querySelector(`td.sample.${t}[sample='${l}']`).querySelector(".attrfield").value}),t.value=constructStringFromTemplate(a)})}function createEditAllField(e){let t;return"sample_name"==e.type_?((t=document.createElement("p")).innerHTML="Must be unique.",t):"file"==e.type_?((t=document.createElement("p")).innerHTML="Upload files separatly.",t):((t=createAttributeField(e)).input.addEventListener("change",function(){this.closest("tr").querySelectorAll("td.sample").forEach(e=>{e.querySelector(".attrfield").value=this.value}),updateTemplateFields()},!1),t.input)}function createTextCell(e,t=[],l="td"){const a=document.createElement(l),n=(a.classList.add(t),document.createElement("p"));return n.innerHTML=e,a.appendChild(n),a}function createEditAllCell(e){const t=document.createElement("td");t.classList.add("editall");e=createEditAllField(e);return t.appendChild(e),t}function createAttributeRow(e){const t=document.createElement("tr");return t.classList.add(e.general_name),t.appendChild(createTextCell(e.label,classList=["title"],element="th")),t.appendChild(createEditAllCell(e)),t.appendChild(createTextCell(e.description,classList=["description"],element="td")),t}function initTable(){SAMPLE_EDITOR.appendChild(createAttributeRow(SAMPLE_NAME_ATTR)),SAMPLE_EDITOR.appendChild(createAttributeRow(SHORT_DESCRIPTION_ATTR)),fetch("/templates/json?name="+TEMPLATE_NAME).then(e=>e.json()).then(e=>{e.attributes.forEach(e=>{SAMPLE_EDITOR.appendChild(createAttributeRow(e))})})}function insertSampleCell(e,t=0){const l=SAMPLE_EDITOR.querySelector("tr."+e.general_name),a=l.insertCell(l.cells.length-1);a.classList.add("sample",e.general_name),a.setAttribute("sample",t),"template"==e.type_&&a.classList.add("template");t=`sample+${t}+`+e.general_name,e=createAttributeField(e,t);a.appendChild(e.input)}async function addSample(e=null){const t=document.querySelector("#samples-header-cell");t.style.display||(t.colSpan=parseInt(t.colSpan)+1);let l=!(t.style.display=""),a,n={...SAMPLE_NAME_ATTR},r={...SHORT_DESCRIPTION_ATTR};const s=parseInt(SAMPLE_EDITOR.rows[1].querySelectorAll("td.sample").length)+1;null!==e&&(a=await fetch("/samples/json?name="+e).then(e=>e.json()).then(e=>e),n.value=a.name,r.value=a.short_description,l=!1),insertSampleCell(n,s),insertSampleCell(r,s),fetch("/templates/json?name="+TEMPLATE_NAME).then(e=>e.json()).then(e=>{e.attributes.forEach(e=>{l||(e.value=a.attributes[e.general_name]),insertSampleCell(e,s)})})}initTable();const sample_names=document.querySelector("#sample-names").value;sample_names&&sample_names.split(",").forEach(e=>{addSample(name=e)});