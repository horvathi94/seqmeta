const SAMPLE_EDITOR=document.querySelector("#sample-editor").tBodies[0],TEMPLATE_NAME=document.querySelector("#template-name").value,SAMPLE_NAME_ATTR={general_name:"name",label:"Sample name",description:"Unique name to differentiate between registered samples.",pattern:"\\w+",type_:"sample_name",value:""},SHORT_DESCRIPTION_ATTR={general_name:"short_description",label:"Short description",description:"A short description to more easily identify the sample.",type_:"text",value:""};function createAttributeField(e,t=""){let a;switch(e.type_){case"text":(a=new TextField(t)).setPattern(e.pattern);break;case"select":a=new SelectField(t,e.options);break;case"date":a=new DateField(t);break;case"template":(a=new TextField(t)).input.placeholder=e.template,a.input.setAttribute("template-string",e.template),a.addClasses(["template"]);break;case"file":a=new FileField(t);break;case"sample_name":(a=new TextField(t)).pattern=e.pattern}return e.value?a.setValue(e.value):a.setValue(e.default),a.addClasses(["attrfield",e.general_name]),"template"!=e.type_&&a.input.addEventListener("change",function(){updateTemplateFields()},!1),a}function updateTemplateFields(e){Array.from(SAMPLE_EDITOR.querySelectorAll("td.sample.template")).forEach(e=>{let a=e.getAttribute("sample"),t=e.querySelector(".attrfield"),l=parseTemplateString(t.getAttribute("template-string"));l.filter(e=>"const"!=e.type).forEach(e=>{let t=e.value;"sample_name"==e.value&&(t="name"),e.fieldValue=SAMPLE_EDITOR.querySelector(`td.sample.${t}[sample='${a}']`).querySelector(".attrfield").value}),t.value=constructStringFromTemplate(l)})}function createEditAllField(e){let t;return"sample_name"==e.type_?((t=document.createElement("p")).innerHTML="Must be unique.",t):"file"==e.type_?((t=document.createElement("p")).innerHTML="Upload files separatly.",t):((t=createAttributeField(e)).input.addEventListener("change",function(){this.closest("tr").querySelectorAll("td.sample").forEach(e=>{e.querySelector(".attrfield").value=this.value}),updateTemplateFields()},!1),t.input)}function createTextCell(e,t=[],a="td"){const l=document.createElement(a),n=(l.classList.add(t),document.createElement("p"));return n.innerHTML=e,l.appendChild(n),l}function createEditAllCell(e){const t=document.createElement("td");t.classList.add("editall");e=createEditAllField(e);return t.appendChild(e),t}function createAttributeRow(e){const t=document.createElement("tr");return t.classList.add(e.general_name),t.appendChild(createTextCell(e.label,classList=["title"],element="th")),t.appendChild(createEditAllCell(e)),t.appendChild(createTextCell(e.description,classList=["description"],element="td")),t}function initTable(){SAMPLE_EDITOR.appendChild(createAttributeRow(SAMPLE_NAME_ATTR)),SAMPLE_EDITOR.appendChild(createAttributeRow(SHORT_DESCRIPTION_ATTR)),fetch("/templates/json?name="+TEMPLATE_NAME).then(e=>e.json()).then(e=>{e.attributes.forEach(e=>{SAMPLE_EDITOR.appendChild(createAttributeRow(e))})})}function insertSampleCell(e,t=0){const a=SAMPLE_EDITOR.querySelector("tr."+e.general_name),l=a.insertCell(a.cells.length-1);l.classList.add("sample",e.general_name),l.setAttribute("sample",t),"template"==e.type_&&l.classList.add("template");t=`sample+${t}+`+e.general_name,e=createAttributeField(e,t);l.appendChild(e.input)}async function addSample(e=null,t=0){const a=document.querySelector("#samples-header-cell");a.style.display||(a.colSpan=parseInt(a.colSpan)+1);let l=!(a.style.display=""),n,r={...SAMPLE_NAME_ATTR},s={...SHORT_DESCRIPTION_ATTR};0==t&&(t=parseInt(SAMPLE_EDITOR.rows[1].querySelectorAll("td.sample").length)+1),null!==e&&(n=await fetch("/samples/json?name="+e).then(e=>e.json()).then(e=>e),r.value=n.name,s.value=n.short_description,l=!1),insertSampleCell(r,t),insertSampleCell(s,t),await fetch("/templates/json?name="+TEMPLATE_NAME).then(e=>e.json()).then(e=>{e.attributes.forEach(e=>{l||(e.value=n.attributes[e.general_name]),insertSampleCell(e,t)})})}initTable();const sample_names=document.querySelector("#sample-names").value;sample_names&&sample_names.split(",").forEach((e,t)=>{addSample(name=e,id=t+1)});