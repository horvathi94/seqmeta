class TemplateAttribute{index=-1;type_="text";name;label;description;ena_requirement="exclude";gisaid_requirement="exclude";pattern="";options=[];constructor(e,t){this.name=e,this.label=t}optionsField(){const e=createNewField(this.index,"textarea","options");return e.addEventListener("change",function(){updateDefaultField(this.parentElement.parentElement)},!1),e.placeholder="Comma separated list of opions",e}patternField(){const e=createNewField(this.index,"text","pattern");return e.addEventListener("change",function(){updateDefaultField(this.parentElement.parentElement)},!1),e.placeholder="Regex for pattern matching.",e}labelField(){}parameterField(){let e;switch(this.type_){case"text":(e=this.patternField()).value=this.pattern;break;case"select":(e=this.optionsField()).value=this.options.join(",");break;default:e=document.createElement("input")}return e}}function appendNewCell(e,t){const a=document.createElement("div");return a.classList.add("cell",t),e.appendChild(a),a}function createNewField(e,t,a,l=[]){var n=["field","attr",a];return createInputField(t,a=`attr+${e}+`+a,l,n)}function createGeneralNameField(e){const t=createNewField(e,"text","general_name");return t.pattern="\\w+",t}function createParameterField(e,t){let a;switch(t){case"text":a=createPatternField(e);break;case"select":a=createOptionsField(e);break;case"template":(a=createNewField(e,"text","template")).placeholder="Template for creating the variable.";break;default:(a=createNewField(e,"text","junk")).placeholder="N/A",a.disabled=!0}return a.classList.add("param"),a}function createDefaultField(e,t,a=[],l=""){let n;return"text"==t&&(n=createNewField(e,"text","default"),""!=l&&(n.pattern=l)),"date"==t&&(n=createNewField(e,"date","default")),"select"==t&&(n=createNewField(e,"select","default",a)),"template"==t&&((n=createNewField(e,"text","default")).placeholder="N/A",n.value="",n.disabled=!0),n}function createRemoveButton(){const e=document.createElement("input");return e.setAttribute("type","button"),e.classList.add("rmbutton"),e.value="X",e.onclick=function(){this.parentElement.parentElement.remove()},e}const REQUIREMENTS=["exclude","optional","recommended","mandatory"],FIELDTYPES=["text","select","date","template"];function createTypeField(e){const t=createNewField(e,"select","type_",options=FIELDTYPES);return t.addEventListener("change",function(){changedAttributeType(this.parentElement.parentElement)},!1),t}function createRequirementField(e,t){const a=createNewField(e,"select",t+"_requirement",options=REQUIREMENTS);return a.addEventListener("change",function(){changedRequirement(this)},!1),a}function updateDefaultField(e,t=null){null===t&&(t=e.querySelector(".cell.type>.attr.field.type_").value);const a=e.querySelector(".cell.default"),l=a.querySelector(".field.attr.default");var n=l.name.split("+")[1];let r=[],d="";"text"==t&&(d=e.querySelector(".parameters.cell>.pattern").value);n=createDefaultField(n,t,r=r="select"==t?e.querySelector(".parameters.cell>.options").value.split(","):r,d=d);a.replaceChild(n,l)}function changedAttributeType(e){const t=e.querySelector(".cell.parameters"),a=t.querySelector(".field.attr.param");var l=e.querySelector(".cell.type>.attr.field.type_").value,n=a.name.split("+")[1];t.replaceChild(createParameterField(n,l),a),updateDefaultField(e,l)}function changedRequirement(e){const t=e.parentElement.parentElement.querySelector(".cell.rm>.rmbutton");"mandatory"==e.value||"recommended"==e.value?t.disabled=!0:t.disabled=!1}function appendRepoField(e,t,a){return(cell=appendNewCell(e,t)).appendChild(createNewField(a,"text",t+"_name")),cell.appendChild(createRequirementField(a,t)),cell}function createNewRow(e){const t=document.createElement("div");t.classList.add("attr","row");let a=appendNewCell(t,"rm");return a.appendChild(createRemoveButton()),(a=appendNewCell(t,"name")).appendChild(createGeneralNameField(e)),(a=appendNewCell(t,"label")).appendChild(createNewField(e,"text","label")),(a=appendNewCell(t,"type")).appendChild(createTypeField(e)),appendRepoField(t,"ena",e),appendRepoField(t,"gisaid",e),(a=appendNewCell(t,"parameters")).appendChild(createParameterField(e,"text")),(a=appendNewCell(t,"default")).appendChild(createDefaultField(e,"text")),(a=appendNewCell(t,"description")).appendChild(createNewField(e,"textarea","description")),t}function createCell(e){const t=document.createElement("div");return t.classList.add("cell",e),t}function createRow(e=null){-1==(e=null===e?new TemplateAttribute:e).index&&(e.index=TEMPLATE_EDITOR.children.length);const t=document.createElement("div");t.classList.add("row","attr");let a=createCell("rm");return a.appendChild(createRemoveButton()),t.appendChild(a),(a=createCell("general_name")).appendChild(createGeneralNameField(e.index)),t.appendChild(a),t}function addNewAttribute(e=null){e=createRow(e);TEMPLATE_EDITOR.appendChild(e)}function appendNewRow(){const e=document.querySelector("#template-editor");var t=createNewRow(e.children.length+1);return e.appendChild(t),t}async function fetchTemplate(e){const t=await fetch("/templates/json/"+e);return t.json()}async function loadTemplate(){var e=parseInt(document.querySelector("#template-id-field").value);e&&(e=await fetchTemplate(e),console.log(e))}TEMPLATE_EDITOR=document.querySelector("#template-editor");