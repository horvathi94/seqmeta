const TEMPLATE_EDITOR=document.querySelector("#template-editor"),FIELD_TYPES=["text","select","date","template"],REQUIREMENT_LEVELS=["exclude","optional","recommended","mandatory"];class AttributeRow{constructor(e,t="text"){this.row=e,this.type=t,this.index=this.row.getAttribute("index"),this.status="registered",this.cells=[],this.row.children.length?this.type=this.getType():(this.initCells(),this.render())}registerCell(e,t=[]){const a=document.createElement("div");a.classList.add("cell",e),t.forEach(e=>{a.appendChild(e)}),this.row.appendChild(a),this.cells.push(a)}initCells(){this.registerCell("rm",[this.removeButton()]),this.registerCell("general_name",[this.attrInput({name:"general_name",type:"text",pattern:"\\w+"})]),this.registerCell("label",[this.attrInput({name:"label",type:"text"})]),this.registerCell("type_",[this.createTypeField()]),this.registerCell("ena",this.createRequirementFields("ena")),this.registerCell("gisaid",this.createRequirementFields("gisaid")),this.registerCell("parameters",[this.createParametersField()]),this.registerCell("default",[this.createDefaultField()]),this.registerCell("description",[this.createDescriptionField()])}createTypeField(){const e=this.attrInput({name:"type_",type:"select",options:FIELD_TYPES});return e.onchange=function(){updateRow(this,"changed-type")},e}createRequirementFields(e){const t=this.attrInput({name:e+"_name",type:"text"}),a=(t.classList.add("reqname"),this.attrInput({name:e+"_requirement",type:"select",options:REQUIREMENT_LEVELS}));return a.onchange=function(){updateRow(this,"changed-requirement")},a.classList.add("reqlevel"),[t,a]}createParametersField(){let e;switch(this.getType()){case"text":(e=this.attrInput({name:"pattern",type:"text"})).placeholder="Regex for input.";break;case"select":(e=this.attrInput({name:"options",type:"textarea"})).placeholder="Comma separated list of options.";break;case"date":(e=this.attrInput({name:"junk",type:"text"})).placeholder="N/A",e.disabled=!0;break;case"template":(e=this.attrInput({name:"template",type:"text"})).placeholder="Template for input field."}return e.classList.add("paramfield"),e.onchange=function(){updateRow(this,"changed-parameters")},e}createDescriptionField(){const e=this.attrInput({name:"description",type:"textarea"});return e.placeholder="Short description.",e}getCell(e){return this.row.querySelector("div.cell."+e)}setName(e){this.getCell("general_name").querySelector("input").value=e}setLabel(e){this.getCell("label").querySelector("input").value=e}setDescription(e){this.getCell("description").querySelector("textarea").value=e}getPattern(){return"text"!=this.getType()?"":this.getCell("parameters").querySelector(".paramfield").value}setPattern(e){"text"==this.getType()&&(this.getCell("parameters").querySelector(".paramfield").value=e,this.replaceDefaultField())}getOptions(){return"select"!=this.getType()?[]:this.getCell("parameters").querySelector(".paramfield").value.split(",")}setOptions(e){"select"==this.getType()&&(this.getCell("parameters").querySelector(".paramfield").value=e.join(","),this.replaceDefaultField())}getType(){return this.getCell("type_").querySelector("select").value}setType(e){this.getCell("type_").querySelector("select").value=e,this.replaceParametersField(),this.replaceDefaultField()}getMaxRequirementLevel(){const t=[];t.push(this.getCell("ena").querySelector(".reqlevel").value),t.push(this.getCell("gisaid").querySelector(".reqlevel").value);let a="exclude";return REQUIREMENT_LEVELS.forEach(e=>{t.includes(e)&&(a=e)}),a}setEnaRequirementLevel(e){this.getCell("ena").querySelector(".reqlevel").value=e}setEnaName(e){this.getCell("ena").querySelector(".reqname").value=e}createDefaultField(){let e;switch(this.getType()){case"text":(e=this.attrInput({name:"default",type:"text",pattern:this.getPattern()})).placeholder="Default value for field.";break;case"select":(e=this.attrInput({name:"default",type:"select",options:this.getOptions()})).placeholder="Default value for field.";break;case"date":e=this.attrInput({name:"default",type:"date"});break;case"template":(e=this.attrInput({name:"template",type:"text"})).placeholder="N/A.",e.disabled=!0}return e.classList.add("defaultfield"),e}removeButton(){const e=document.createElement("input");return e.setAttribute("type","button"),e.classList.add("rmbutton"),e.value="X",e.onclick=function(){updateRow(this,"remove")},e}attrInput({name:e="",type:t="",pattern:a="",options:r=[]}){var l=`attr+${this.status}+${this.index}+`+e;let s;switch(t){case"text":(s=new TextField(l)).setPattern(a);break;case"select":s=new SelectField(l,r);break;case"textarea":s=new TextAreaField(l);break;case"date":s=new DateField(l)}return s.input}updateRemoveButton(){var e=this.getMaxRequirementLevel();console.log("Working with: ",e);const t=this.getCell("rm").querySelector(".rmbutton");"mandatory"==e?(console.log("Disableing"),t.disabled=!0):(console.log("Enabling"),t.disabled=!1)}replaceParametersField(){const e=this.getCell("parameters");var t=e.querySelector(".paramfield");e.replaceChild(this.createParametersField(),t)}replaceDefaultField(){const e=this.getCell("default");var t=e.querySelector(".defaultfield");e.replaceChild(this.createDefaultField(),t)}update(e){switch(console.log(`Updating with command=${e} in `+this.row),e){case"remove":this.row.remove();break;case"changed-type":var t=this.getType();this.setType(t);break;case"changed-parameters":"text"==this.getType()&&this.setPattern(this.getPattern()),"select"==this.getType()&&this.setOptions(this.getOptions());break;case"changed-requirement":this.updateRemoveButton()}}render(){this.cells.forEach(e=>{this.row.appendChild(e)})}static create(e){const t=document.createElement("div");return t.classList.add("row","new"),t.setAttribute("index",e),t}}function updateRow(e,t){const a=new AttributeRow(e.closest("div.row"));a.update(t)}function insertNewAttribute(){var e=TEMPLATE_EDITOR.querySelectorAll("div.row.new").length+1,e=AttributeRow.create(e),e=(TEMPLATE_EDITOR.appendChild(e),new AttributeRow(e));return e}